<div class="post-show-bg">
  <div class="container mt-5">

    <div class="row">

      <!-- 左：今日の記録 -->
      <div class="col-md-7">

        <h1 class="text-center mb-2">
          今日の記録
        </h1>

        <p class="text-center text-muted mb-4">
          <%= @post.created_at.strftime("%Y年%m月%d日") %>
        </p>

        <p class="text-center small text-muted mb-3">
          今日、誰かと話したかった人
        </p>

        <p class="text-center mb-4">
          <%= @post.user&.name || "匿名ユーザー" %>
        </p>

        <% if @post.image.attached? %>
          <%= image_tag @post.image, class: "img-fluid mb-4" %>
        <% end %>

        <h2 class="mt-4 mb-2">
          今日のひとこと
        </h2>

        <div class="mt-2">
          <% if user_signed_in? %>
            <% if @post.likes.exists?(user: current_user) %>
              <%= button_to post_like_path(@post, @post.likes.find_by(user: current_user)),
                    method: :delete,
                    class: "btn btn-link p-0 text-danger" do %>
                ❤️ <%= @post.likes.count %> いいね
              <% end %>
            <% else %>
              <%= button_to post_likes_path(@post),
                    method: :post,
                    class: "btn btn-link p-0 text-muted" do %>
                🤍 <%= @post.likes.count %> いいね
              <% end %>
            <% end %>
          <% else %>
            <span class="text-muted small">
              ❤️ <%= @post.likes.count %> いいね
            </span>
          <% end %>
        </div>

        <p class="mb-4">
          <%= simple_format(@post.content) %>
        </p>

        <% if @post.user == current_user %>
          <div class="mt-4">
            <%= link_to "書き直す",
                  edit_post_path(@post),
                  class: "btn btn-outline-secondary me-2" %>

            <%= link_to "この記録を削除する",
                  post_path(@post),
                  data: { turbo_method: :delete, turbo_confirm: "この日の記録を削除しますか？" },
                  class: "btn btn-outline-danger" %>
          </div>
        <% end %>

      </div>

      <!-- 右：コメント -->
      <div class="col-md-5">

        <h3 class="mb-2">
          この日に交わされた言葉
        </h3>

        <p class="text-muted mb-3">
          💬 <%= @comments.count %> 件のやりとり
        </p>

        <% @comments.each do |comment| %>
          <div class="mb-3 p-3 border rounded bg-white">
            <div class="d-flex justify-content-between mb-1">
              <span class="small text-muted">
                <%= comment.user&.name || "匿名ユーザー" %>
              </span>
              <span class="small text-muted">
                <%= comment.created_at.strftime("%m/%d") %>
              </span>
            </div>

            <p class="mb-1">
              <%= comment.content %>
            </p>

            <% if comment.user == current_user %>
              <%= link_to "この言葉を消す",
                    post_comment_path(@post, comment),
                    data: { turbo_method: :delete, turbo_confirm: "この言葉を消しますか？" },
                    class: "btn btn-sm btn-link text-muted p-0" %>
            <% end %>
          </div>
        <% end %>

        <hr>

        <h4 class="mb-2">
          今日のあなたへ返す
        </h4>

        <%= form_with(model: [@post, @comment], local: true) do |f| %>
          <%= f.text_area :content,
                rows: 3,
                placeholder: "ひとこと返す",
                class: "form-control mb-2" %>

          <%= f.submit "送信する",
                class: "btn btn-success btn-sm" %>
        <% end %>

      </div>
    </div>

    <div class="text-center mt-5">
      <%= link_to "← 今日の投稿一覧へ戻る",
            posts_path,
            class: "btn btn-outline-secondary btn-sm" %>
    </div>

  </div>
</div>
